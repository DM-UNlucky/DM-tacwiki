# 第三部分 · 贴图与上色
## 优化模型
### 面剔除
第一步是对模型进行面数优化，这里我们需要借助Optimize插件，它可以自动计算模型重叠与不可见的面并自动删除。但请注意，在进行面剔除前务必备份模型，并且尽可能只对分离的局部结构进行操作
插件可以在blockbench中直接安装，前往plugin – available 搜索optimize即可。

![优化插件](/model_guide/texture/3.1.1.png)

请注意，optimize插件可能会出现错误，例如在基岩版或自由模型格式中，常常会删除一些外露的面。遇到这种情况请及时Ctrl+Z撤回并检查模型。如果一个部件无法被插件正确地优化，宁可手动面剔除或不进行面剔除。

Optimize可以在 工具 界面找到，操作界面如

![插件界面](/model_guide/texture/3.1.2.1.png)

![插件界面](/model_guide/texture/3.1.2.2.png)

两项勾选框分别为** 仅限所选元素** 和 **应用面剔除**。

请务必勾选仅限所选元素，否则插件将会对模型所有元素进行无差别优化。

勾选面剔除后，优化会直接剔除该面的UV信息。

实例操作：对护木进行面剔除优化
**请务必备份模型！
请务必备份模型！
请务必备份模型！**

在大纲视图中选中该骨骼，并按下I仅在预览中显示该骨骼。
选中骨骼，打开 工具 – optimize，勾选两项选项
应用，并检查是否有误删除的面。**如有请及时撤销操作或启用备份。**
若操作成功，则可以看到一些面已被删除。
正确使用该插件将减少20%-40%面数，提高游戏运行效率。

![插件自动优化模型](/model_guide/texture/3.1.3.1.png)

![插件自动优化模型](/model_guide/texture/3.1.3.2.png)

![插件自动优化模型](/model_guide/texture/3.1.3.3.png)

按同样的步骤对其他结构进行优化
同样的，你也可以在左侧UV编辑栏中进行手动面剔除。这适用于一些精确的剔除，或补全插件无法识别的情况。该按键可以剔除所选中的UV面。

![手动面剔除](/model_guide/texture/3.1.4.1.png)

![手动面剔除](/model_guide/texture/3.1.4.2.png)

如果遇到了误删面，但工程已经进行了相当的部分，启用备份已经不可能，如何进行恢复呢？

![ UV工具“应用到所有面”](/model_guide/texture/3.1.5.png)

点选方块依然存在的面，前往UV栏选择油漆桶图标 “应用到所有面”，就可以将已被删除的UV面恢复。

如果模型已经拥有了贴图，那么该贴图将会自动应用到这个方块的所有面，这是不利于上色工作的

我们可以选择右键模型的贴图，选择“向模板追加元素”，这样方块的六个面的贴图将会被重新分配。

或者全选/选择局部模型，重新生成贴图，也可以给模型自动分配新的逐面UV。

![ 向模板追加元素](/model_guide/texture/3.1.6.png)

### Z-Fighting
>在完成了优化之后，第二步是解决模型的z fighting问题
我们将在这里使用到 【膨胀】 （inflate）功能。

Inflate可以取正负值，并且不会影响方块的UV面效果。在进行膨胀时，请注意方块互相之间的遮盖关系，确保在上层的面是想要的。

通常来说，**±0.001-0.005**的膨胀值已经足以。
修复z fighting的工作之所以到完成模型时才做，是因为经过inflate操作的方块会影响到顶点捕捉，并且可能由于软件的浮点数精度导致模型出现对称操作上的问题。

当然，并不是要对所有的z fighting面都进行inflate以防止重叠。对于一些不太重要的面，可以通过涂上相同的颜色来掩盖z-fighting效果。
在接下来的上色过程中你也可以进行同样的操作。

![ 使用膨胀-0.001解决z fighting](/model_guide/texture/3.1.7.1.png)

![ 使用膨胀-0.001解决z fighting](/model_guide/texture/3.1.7.2.png)

![ 使用膨胀-0.001解决z fighting](/model_guide/texture/3.1.7.3.png)

## 创建贴图
### 创建贴图
在大纲视图中确保所有你想要生成贴图的方块以及骨骼在预览中**都可见**并且**没有被锁定**
然后在左侧UV工具栏中选择创建贴图

![ 创建贴图](/model_guide/texture/3.2.1.png)

如图勾选，创建贴图，bb将会自动生成逐面贴图并分配UV。请注意，我们只能使用**逐面贴图**，因为我们的方块体积并不是整数。

![ 创建贴图选项](/model_guide/texture/3.2.2.png)

![ 创建完成效果](/model_guide/texture/3.2.3.png)

### 快速上色
接下来我们使用油漆桶为模型进行固有色快速上色。
>请注意，在着色时务必**关闭 阴影 选项**，这会干扰对固有色的判断

>![ 阴影选项](/model_guide/texture/3.2.4.png)

按B进入绘画模式，按Y选择油漆桶，在顶部栏中选择上色模式为 颜色 ，在UV界面中点选生成的贴图，并用油漆桶点击UV编辑栏中需要着色的颜色，就可以批量替换颜色了。

![ 批量替换颜色](/model_guide/texture/3.2.5.1.png)

![ 批量替换颜色](/model_guide/texture/3.2.5.2.png)

对于枪械的黑铁颜色，固有色相对来说饱和度和纯度都较低，饱和度一般不超过20，以5-10为佳，色相选择在蓝色-青色范围

对于UV贴图的批量替换颜色，程序给不同朝向的面分配的颜色是不同的，例如偏亮的颜色，通常也是受光面。在进行上色时，可以在调色板中选取更亮的颜色。

![ 朝上、前面自动着色为蓝色和白色](/model_guide/texture/3.2.6.png)

在批量替换颜色之后，你的枪应该看起来是这样的：

![ 粗略上色](/model_guide/texture/3.2.7.png)

### 细节刻画
现在，我们的模型已经有了最基础的光影关系了，下一步我们将着重细化不同结构之间的纹理细节和对光影细节进行进一步刻画

切记，枪械模型的写实上色最主要的目的就是用**光影关系刻画和凸显结构**。因为对于普遍的枪械来说，整体的颜色都非常灰暗，只能依赖颜色的对比度来进行体积细节刻画。

我们先假设有一个平行光源位于枪械前上方区域，因此作为第一人称模型，我们需要了解哪些光线在被枪械表面反射后最容易进入我们的眼睛，显现出最亮的颜色；
>如图所示，展示了虚构光源可能会产生的光照效果。

![ 明暗原理解释](/model_guide/texture/3.2.7.png)

一个最普遍的技巧就是：
- 在东西朝向的45°斜面上，颜色最亮，
- 顶面颜色次于斜面，
- 东西方向垂直侧面次于顶面，
- 南北方向的面次于侧面，
- 底面次于南北面

对于金属表面，通常我们可以认为亮面越亮，饱和度越低，暗面越暗，纯度越高，也即是“**亮纯暗灰**”。

![ 饱和度与亮度](/model_guide/texture/3.2.9.png)

要注意的是，尽量避免在表面光影关系中使用**纯黑或者纯白**的极端情况，这些颜色只有特殊情况下才会使用，比如使用纯黑来营造深度感。
>例如在体积的内部涂上黑色，可以进一步强化空间结构的区分度

![ 空间内部涂色为纯黑](/model_guide/texture/3.2.10.png)

以下将展示一些现实照片实例，但不要一味地照抄现实照片的效果，因为光源效果各异：

![ 黑铁材质着色例图](/model_guide/texture/3.2.11.png)

为了更好地区分枪械不同部分的体积关系，我们可以使用更多的颜色层次，包括但不限于**微调明度，饱和度和色相。**

通常来说，对于两个颜色相近的部件，使用适当的色相拉开区分度是很有效的

>例如上机匣与下机匣，由于下机匣受光更少，我们可以将色相往**浅蓝色偏并微调明度和饱和度**，拉开区分度：
对于其他的大结构也是如此。取色上，可以参考现实或游戏中的照片效果。

![ 大体积分色](/model_guide/texture/3.2.12.png)

到目前为止我们仅仅只用了油漆桶工具就营造了基础的光影关系。接下来我们会根据铺上的基础色调进行细节修饰。

通常来说，在一个垂直的面结构中，我们可以套路化的给它添加上亮下暗，前亮后暗的渐变效果，

但请注意，**不要在这里使用带有不透明度的笔刷**，这会导致表面颜色过多而产生混乱感，破坏原有的光影关系，以及增加过多不同色相和明度的颜色，将导致曲线调色出现噪点。

要加深阴影关系，通常可以对当前面进行取色，并在调色板中将色值往下或者右下取色，亮面反之；

如果你觉得只有两种颜色太少导致分界线过于明显，对比度过高，可以在这两色之间再取一个中间色做过渡；

我们可以在颜色与颜色之间使用 抖动 来做出混合效果。抖动是一种传统的像素画技法，你可以在网络上搜索以获取更多详细信息，这里不做赘述；

总之，凸显结构的要义就是**明暗交界处的对比度**

![ 上色技巧](/model_guide/texture/3.2.13.1.png)

![ 上色技巧](/model_guide/texture/3.2.13.2.png)

![ 上色技巧](/model_guide/texture/3.2.13.3.png)

![ 上色技巧](/model_guide/texture/3.2.13.4.png)

![ 上色技巧](/model_guide/texture/3.2.13.5.png)

对下机匣使用同样的方法，我们可以得到一个类似的效果
请注意，抖动不是必须的，在大片的平面上，抖动有助于增加纹理细节和柔和化过度，但在更狭小的空间上，保持更少更连续的颜色也能得到很好的效果

![ 细化纹理](/model_guide/texture/3.2.14.png)

>技巧：亮面暗面的过渡和隔断
在一体化结构的交界处加上阴影可以弱化转折，让结构更加紧密联系

![ 环境光遮蔽](/model_guide/texture/3.2.15.1.png)

![ 环境光遮蔽](/model_guide/texture/3.2.15.2.png)

在需要拆分结构或者转折的地方用亮面凸显不同的结构

![ 突出结构细节](/model_guide/texture/3.2.16.png)

在转折锐利的地方，通常对比度拉的更大

![ 导轨的上色](/model_guide/texture/3.2.17.png)

从向光处向后也可以做由浅到深的渐变，中间掺杂抖动效果丰富纹理细节。

![ 渐变与抖动](/model_guide/texture/3.2.18.png)

更大面积的平面可以让纹理有整体感和连接感，体现金属由于不同粗糙度和反射率所体现的的表面纹理。

![ 大面积上色](/model_guide/texture/3.2.19.1.png)

![ 大面积上色](/model_guide/texture/3.2.19.2.png)

部分部件可以有由于高温所造成的退火表面，丰富模型颜色；

![ 表面退火的枪口制退器](/model_guide/texture/3.2.20.png)

### 程序调色
在UV工作栏可以调整纹理的色相，对比度与亮度

![  UV工具栏中的调色与曲线工具](/model_guide/texture/3.2.21.png)

如果觉得颜色太暗了，可以通过调整亮度与对比度的方式整体提亮：

![调整对比度与亮度](/model_guide/texture/3.2.22.png)

![调整效果](/model_guide/texture/3.2.23.1.png)

![调整效果](/model_guide/texture/3.2.23.2.png)

关于对比度，亮度，色相RGB曲线的具体使用方式，本文不在此赘述，请根据需要自行查阅学习。
如果对当前局部的效果不满意，可以单选某个具体的骨骼生成贴图，进行单独的曲线调整

![单独生成局部贴图进行调整](/model_guide/texture/3.2.24.png)

请注意，创建的贴图最好不要有多个重名，否则相互替换可能导致贴图读取出错
上色完成的成品：

![成品效果](/model_guide/texture/3.2.25.1.png)

![成品效果](/model_guide/texture/3.2.25.2.png)

在模型完成后，如果觉得缺乏细节，我们可以用另一个方法：表面贴花
贴花通常是一些商标，铭文或者logo，按自己喜好进行制作即可
在这里，我将使用以下贴花：
将贴花的贴图文件复制一份并导入到工程文件中

![导入贴花到工程文件](/model_guide/texture/3.2.27.png)

- 请注意贴花的分辨率与模型贴图分辨率，如果贴花的分辨率大于模型贴图分辨率，同样可以右键模型贴图并选择“设置贴图大小”来扩大贴图画布
- 
![调整原有模型贴图画布大小](/model_guide/texture/3.2.28.png)

右键模型纹理，选中“在blockbench中编辑”

![ blockbench内置的编辑器](/model_guide/texture/3.2.29.png)

在UV工作区中使用Ctrl+C复制贴花贴图，并粘贴到编辑中的贴图中，选择贴图中的空位并“放置”
建议将贴花的位置贴边放置以便后续手动调整UV
导入的贴花贴图分辨率建议为2的幂次方，方便之后在UV贴图中定位。

![ 合并贴花与纹理贴图](/model_guide/texture/3.2.30.png)

新建一个方块并手动删除其他不需要的面。

![ 贴花平面](/model_guide/texture/3.2.31.png)

将贴图拖拽到想要应用的面上

![ 应用贴图到平面](/model_guide/texture/3.2.32.png)

手动调整UV，同时注意让贴花的分辨率匹配方块的长宽比，例如此处的方块长宽比为4:1，此处贴花的UV分辨率也为4：1的倍数。

![ 拥有贴花的模型](/model_guide/texture/3.2.33.1.png)

效果展示：

![ 拥有贴花的模型](/model_guide/texture/3.2.33.2.png)

至此，你的模型基本完成了。